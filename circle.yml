
dependencies:

  pre:
    - if [ ! -e /usr/local/android-sdk-linux/platforms/android-25 ]; then echo y | android update sdk --all --no-ui --filter "android-25"; fi;
    - if [ ! -e /usr/local/android-sdk-linux/build-tools/25.0.2 ]; then echo y | android update sdk --all --no-ui --filter "build-tools-25.0.2"; fi;
    - if ! $(grep -q "Revision=43.0.0" /usr/local/android-sdk-linux/extras/android/m2repository/source.properties); then echo y | android update sdk --all --no-ui --filter "extra-android-m2repository"; fi;
  cache_directories:
     - /usr/local/android-sdk-linux/build-tools/25.0.2
     - /usr/local/android-sdk-linux/platforms/android-25
     - /usr/local/android-sdk-linux/extras/android/m2repository

test:

  override:
        - (./gradlew test assembleRelease javadoc):
            timeout: 360

  post:

    # lib:
    - cp -r ${HOME}/${CIRCLE_PROJECT_REPONAME}/core/build/outputs/aar/ $CIRCLE_ARTIFACTS

#    # javadoc:
#    - cp -r ${HOME}/${CIRCLE_PROJECT_REPONAME}/core/build/docs/javadoc/ $CIRCLE_ARTIFACTS


    # junit xml report:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit-xml/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit-xml/ \;

    # junit html report:
    # TODO: recursively copy subdirs etc
    - mkdir -p $CIRCLE_TEST_REPORTS/junit-html/
    - cp -r ${HOME}/${CIRCLE_PROJECT_REPONAME}/core/build/reports/tests/release/* $CIRCLE_TEST_REPORTS/junit-html/

#    # lint report:
#    - mkdir -p $CIRCLE_TEST_REPORTS/lint/
#    - find . -type f -regex ".*/build/outputs/.*html" -exec cp {} $CIRCLE_TEST_REPORTS/lint/ \;

#deployment:
#    master:
#        branch: master
#        commands:
#            - (./gradlew bintrayUpload):
#                timeout: 360